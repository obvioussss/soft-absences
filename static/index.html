<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion des Absences</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    <!-- Script de configuration en premier -->
    <script src="/static/js/config.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè¢ Gestion des Absences</h1>
        </div>
        
        <!-- Section d'authentification -->
        <div id="auth-section" class="auth-section">
            <h2>Connexion</h2>
            <form id="login-form">
                <div class="form-group">
                    <label for="email">Email :</label>
                    <input type="email" id="email" value="hello.obvious@gmail.com" required autocomplete="email">
                </div>
                <div class="form-group">
                    <label for="password">Mot de passe :</label>
                    <input type="password" id="password" value="admin123" required autocomplete="current-password">
                </div>
                <button type="submit" class="btn">Se connecter</button>
            </form>
        </div>
        
        <!-- Contenu principal -->
        <div id="main-content" class="main-content">
            <div class="user-info" id="user-info">
                <!-- Info utilisateur -->
            </div>
            <div style="clear: both;"></div>
            
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="showTab('dashboard')">Tableau de bord</button>
                <button class="nav-tab" onclick="showTab('calendar')">Calendrier</button>
                <button class="nav-tab user-only" onclick="showTab('procedure')">Mes Demandes</button>
                <button class="nav-tab admin-only" onclick="showTab('admin-users')" style="display: none;">Utilisateurs</button>
                <button class="nav-tab admin-only" onclick="showTab('admin-requests')" style="display: none;">üìã Demandes</button>
                
                <button class="nav-tab" onclick="logout()">D√©connexion</button>
            </div>
            
            <!-- Tableau de bord -->
            <div id="dashboard" class="tab-content active">
                <h2>Tableau de bord</h2>
                <div id="dashboard-content" class="loading">Chargement...</div>
            </div>
            

            
            <!-- Calendrier -->
            <div id="calendar" class="tab-content">
                <!-- Calendrier pour admin (vue mensuelle) et utilisateurs (vue annuelle) -->
                <div id="calendar-section" class="calendar-container">
                    <div class="calendar-header">
                        <div class="calendar-nav">
                            <button id="prev-period" class="nav-btn">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                    <path d="M15 18l-6-6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                            <h2 id="calendar-title">Calendrier</h2>
                            <button id="next-period" class="nav-btn">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                    <path d="M9 18l6-6-6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                        </div>
                        <div class="calendar-actions">
                            <button id="today-btn" class="btn btn-secondary">Aujourd'hui</button>
                            <button id="admin-add-absence-btn" class="btn btn-primary admin-only" onclick="showAdminAbsenceForm()" style="display: none;">‚ûï Ajouter absence</button>
                            <div id="calendar-summary" class="calendar-summary" style="display: none;">
                                <span id="summary-text"></span>
                            </div>
                        </div>
                    </div>

                    <!-- Vue mensuelle pour admin -->
                    <div id="monthly-calendar" class="monthly-view" style="display: none;">
                        <div class="calendar-grid">
                            <div class="calendar-weekdays">
                                <div class="weekday">Lun</div>
                                <div class="weekday">Mar</div>
                                <div class="weekday">Mer</div>
                                <div class="weekday">Jeu</div>
                                <div class="weekday">Ven</div>
                                <div class="weekday">Sam</div>
                                <div class="weekday">Dim</div>
                            </div>
                            <div id="calendar-days" class="calendar-days">
                                <!-- Les jours seront g√©n√©r√©s par JavaScript -->
                            </div>
                        </div>
                    </div>

                    <!-- Vue annuelle pour utilisateurs -->
                    <div id="yearly-calendar" class="yearly-view" style="display: none;">
                        <div class="year-grid">
                            <!-- Les 12 mois seront g√©n√©r√©s par JavaScript -->
                        </div>
                    </div>

                    <!-- Modal pour afficher les d√©tails d'un √©v√©nement -->
                    <div id="event-modal" class="modal" style="display: none;">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h3 id="event-title">D√©tails de l'absence</h3>
                                <button class="modal-close" onclick="closeEventModal()">&times;</button>
                            </div>
                            <div class="modal-body">
                                <div class="event-details">
                                    <div class="detail-row">
                                        <strong>Utilisateur:</strong>
                                        <span id="event-user"></span>
                                    </div>
                                    <div class="detail-row">
                                        <strong>Type:</strong>
                                        <span id="event-type"></span>
                                    </div>
                                    <div class="detail-row">
                                        <strong>Dates:</strong>
                                        <span id="event-dates"></span>
                                    </div>
                                    <div class="detail-row">
                                        <strong>Status:</strong>
                                        <span id="event-status"></span>
                                    </div>
                                    <div class="detail-row" id="event-reason-row" style="display: none;">
                                        <strong>Raison:</strong>
                                        <span id="event-reason"></span>
                                    </div>
                                    <div class="detail-row admin-only" style="display:none; gap:8px;">
                                        <button id="event-edit-btn" class="btn btn-warning">Modifier</button>
                                        <button id="event-delete-btn" class="btn btn-danger">Supprimer</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Formulaire admin pour cr√©er une absence -->
                    <div id="admin-absence-modal" class="modal" style="display: none;">
                        <div class="modal-content" style="max-width: 600px;">
                            <div class="modal-header">
                                <h3 style="color: #e74c3c; margin: 0;">üë®‚Äçüíº Cr√©er une absence (Admin)</h3>
                                <button class="modal-close" onclick="hideAdminAbsenceForm()">&times;</button>
                            </div>
                            <div class="modal-body">
                                <form id="admin-absence-form-element">
                                    <div class="form-group">
                                        <label for="admin-absence-user">Utilisateur :</label>
                                        <select id="admin-absence-user" required>
                                            <option value="">S√©lectionner un utilisateur...</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="admin-absence-type">Type d'absence :</label>
                                        <select id="admin-absence-type" required>
                                            <option value="vacances">Vacances</option>
                                            <option value="maladie">Maladie</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="admin-start-date">Date de d√©but :</label>
                                        <input type="date" id="admin-start-date" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="admin-end-date">Date de fin :</label>
                                        <input type="date" id="admin-end-date" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="admin-comment">Commentaire admin (optionnel) :</label>
                                        <textarea id="admin-comment" placeholder="Commentaire pour l'utilisateur..."></textarea>
                                    </div>
                                    <div class="form-group" id="admin-absence-pdf-group" style="display:none;">
                                        <label for="admin-absence-pdf">Certificat m√©dical (PDF) :</label>
                                        <div id="admin-absence-dropzone" style="border: 2px dashed #ffc107; padding: 20px; border-radius: 8px; background: #fff8e1; text-align: center; cursor: pointer;">
                                            Glissez-d√©posez le PDF ici, ou cliquez pour s√©lectionner.
                                            <input type="file" id="admin-absence-pdf" accept=".pdf" style="display:none;">
                                        </div>
                                        <small id="admin-absence-pdf-name" style="display:block; color:#856404; margin-top:6px;">Aucun fichier s√©lectionn√©</small>
                                        <small style="display:block; color:#856404; margin-top:6px;">PDF uniquement, 10MB max</small>
                                    </div>
                                    <div style="text-align: right; margin-top: 20px;">
                                        <button type="button" class="btn" onclick="hideAdminAbsenceForm()">Annuler</button>
                                        <button type="submit" class="btn btn-success">Cr√©er l'absence</button>
                                    </div>
                    
                    
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Proc√©dure -->
            <div id="procedure" class="tab-content">
                <h2>Mes Demandes d'Absence</h2>
                
                <!-- Boutons d'action -->
                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <button class="btn" onclick="showNewRequestForm()">‚ûï Nouvelle demande de cong√©</button>
                    <button class="btn btn-warning" onclick="showSicknessDeclarationForm()">üè• D√©claration de maladie</button>
                </div>
                
                <!-- Formulaire de nouvelle demande int√©gr√© -->
                <div id="new-request-form" style="display: none; margin-bottom: 20px; background: #f8f9fa; padding: 20px; border-radius: 8px;">
                    <h3>Nouvelle demande d'absence</h3>
                    <form id="absence-form">
                        <div class="form-group">
                            <label for="absence-type">Type d'absence :</label>
                            <select id="absence-type" required>
                                <option value="vacances">Vacances</option>
                                <option value="maladie">Maladie</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="start-date">Date de d√©but :</label>
                            <input type="date" id="start-date" required>
                        </div>
                        <div class="form-group">
                            <label for="end-date">Date de fin :</label>
                            <input type="date" id="end-date" required>
                        </div>
                        <div class="form-group">
                            <label for="reason">Raison (optionnel) :</label>
                            <textarea id="reason" placeholder="Motif de la demande..."></textarea>
                        </div>
                        <button type="submit" class="btn btn-success">Soumettre</button>
                        <button type="button" class="btn" onclick="hideNewRequestForm()">Annuler</button>
                    </form>
                </div>
                
                <!-- Formulaire de d√©claration de maladie -->
                <div id="sickness-declaration-form" style="display: none; margin-bottom: 20px; background: #fff3cd; padding: 20px; border-radius: 8px; border: 2px solid #ffc107;">
                    <h3 style="color: #856404;">üè• D√©claration de maladie avec certificat m√©dical</h3>
                    <p style="color: #856404; margin-bottom: 15px;">
                        <strong>Note:</strong> Cette d√©claration sera automatiquement envoy√©e avec votre certificat m√©dical √† hello.obvious@gmail.com
                    </p>
                    <form id="sickness-form" enctype="multipart/form-data">
                        <div class="form-group">
                            <label for="sickness-start-date">Date de d√©but :</label>
                            <input type="date" id="sickness-start-date" required>
                        </div>
                        <div class="form-group">
                            <label for="sickness-end-date">Date de fin :</label>
                            <input type="date" id="sickness-end-date" required>
                        </div>
                        <div class="form-group">
                            <label for="sickness-description">Description (optionnel) :</label>
                            <textarea id="sickness-description" placeholder="D√©tails sur l'arr√™t maladie..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="sickness-pdf">Certificat m√©dical (PDF) :</label>
                            <input type="file" id="sickness-pdf" accept=".pdf" required>
                            <small style="color: #856404; display: block; margin-top: 5px;">Fichier PDF uniquement, maximum 10MB</small>
                        </div>
                        <button type="submit" class="btn btn-warning">üìß Envoyer la d√©claration</button>
                        <button type="button" class="btn" onclick="hideSicknessDeclarationForm()">Annuler</button>
                    </form>
                </div>
                
                <!-- Sous-onglets pour les demandes utilisateur -->
                <div class="sub-tabs" style="margin-top: 10px;">
                    <button class="sub-tab active" onclick="showSubTab('user-vacation-requests')">üèñÔ∏è Demandes de Vacances</button>
                    <button class="sub-tab" onclick="showSubTab('user-sickness-declarations')">üè• D√©clarations de Maladie</button>
                </div>
                <div id="user-vacation-requests" class="sub-tab-content active">
                    <div id="user-vacation-requests-list" class="loading">Chargement...</div>
                </div>
                <div id="user-sickness-declarations" class="sub-tab-content">
                    <div id="user-sickness-declarations-list" class="loading">Chargement...</div>
                </div>
                
                <!-- Section proc√©dure s√©par√©e -->
                <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #007bff;">
                    <h3>üìñ Proc√©dure et Informations</h3>
                    <div style="max-width: 800px; line-height: 1.6;">
                        <p>Pour assurer une bonne organisation au sein de l'√©quipe, veuillez suivre la proc√©dure ci-dessous pour toute demande de cong√©s :</p>
                    
                    <ol style="margin: 20px 0; padding-left: 30px;">
                        <li><strong>D√©lai de demande :</strong> Formuler votre demande au moins 2 mois √† l'avance (sauf urgence) par email hello.obvious@gmail.com</li>
                        <li><strong>Validation :</strong> La demande doit √™tre approuv√©e par un r√©ponse √©crite via la chaine de mail.</li>
                        <li><strong>Confirmation :</strong> Une fois valid√©e, l'absence sera not√©e dans le calendrier d'√©quipe</li>
                    </ol>
                    
                    <h3>Types d'Absences</h3>
                    
                    <div style="margin-bottom: 20px;">
                        <h4><strong>Cong√©s Pay√©s Annuels</strong></h4>
                        <p>Chaque salari√© dispose de 25 jours ouvr√©s de cong√©s pay√©s par an (du 1er juin au 31 mai).</p>
                        <p>Le fractionnement des cong√©s est possible sous certaines conditions.</p>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h4><strong>RTT (R√©duction du Temps de Travail)</strong></h4>
                        <p>Nombre de jours selon votre contrat et la convention collective applicable.</p>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h4><strong>Cong√©s Exceptionnels</strong></h4>
                        <ul style="margin-left: 20px;">
                            <li>Mariage/PACS : 4 jours</li>
                            <li>Naissance/Adoption : 3 jours</li>
                            <li>D√©c√®s d'un proche : 1 √† 3 jours selon le lien de parent√©</li>
                            <li>D√©m√©nagement : 1 jour</li>
                        </ul>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h4><strong>Arr√™t Maladie</strong></h4>
                        <p>En cas de maladie, informer votre responsable d√®s que possible.</p>
                        <p>Envoyer votre arr√™t de travail dans les 48 heures √† l'employeur et √† la CPAM.</p>
                        <p><strong>Nouveau:</strong> Vous pouvez maintenant utiliser le formulaire de d√©claration de maladie ci-dessus pour envoyer automatiquement votre certificat m√©dical.</p>
                    </div>
                </div>
            </div>
            </div>
            
            <!-- Admin: Gestion des utilisateurs -->
            <div id="admin-users" class="tab-content">
                <h2>Gestion des utilisateurs</h2>
                <button class="btn" onclick="showNewUserForm()">‚ûï Nouvel utilisateur</button>
                
                <!-- Formulaire utilisateur int√©gr√© -->
                <div id="new-user-form" style="display: none; margin-top: 20px; background: #f8f9fa; padding: 20px; border-radius: 8px;">
                    <h3>Nouvel utilisateur</h3>
                    <form id="user-form">
                        <div class="form-group">
                            <label for="user-email">Email :</label>
                            <input type="email" id="user-email" required autocomplete="email">
                        </div>
                        <div class="form-group">
                            <label for="user-first-name">Pr√©nom :</label>
                            <input type="text" id="user-first-name" required autocomplete="given-name">
                        </div>
                        <div class="form-group">
                            <label for="user-last-name">Nom :</label>
                            <input type="text" id="user-last-name" required autocomplete="family-name">
                        </div>
                        <div class="form-group">
                            <label for="user-role">R√¥le :</label>
                            <select id="user-role" required>
                                <option value="user">Utilisateur</option>
                                <option value="admin">Administrateur</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="user-password">Mot de passe :</label>
                            <input type="password" id="user-password" required autocomplete="new-password">
                        </div>
                        <button type="submit" class="btn btn-success">Cr√©er</button>
                        <button type="button" class="btn" onclick="hideNewUserForm()">Annuler</button>
                    </form>
                </div>
                
                <div id="users-list" class="loading" style="margin-top: 20px;">Chargement...</div>
                
                <!-- Modal pour le r√©sum√© des absences d'un utilisateur -->
                <div id="user-absence-modal" class="modal" style="display: none;">
                    <div class="modal-content" style="max-width: 800px;">
                        <div class="modal-header">
                            <h3 id="user-absence-title">R√©sum√© des absences</h3>
                            <button class="modal-close" onclick="closeUserAbsenceModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div id="user-absence-summary" class="loading">Chargement...</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Admin: Toutes les demandes -->
            <div id="admin-requests" class="tab-content">
                <h2>üìã Gestion des Demandes - Administrateur</h2>
                
                <!-- Sous-onglets pour les demandes -->
                <div class="sub-tabs">
                    <button class="sub-tab active" onclick="showSubTab('vacation-requests')">üèñÔ∏è Demandes de Vacances</button>
                    <button class="sub-tab" onclick="showSubTab('sickness-declarations')">üè• D√©clarations de Maladie</button>
                    <button class="sub-tab" onclick="showSubTab('admin-documents')">üìÑ Documents</button>
                </div>
                
                <!-- Contenu des sous-onglets -->
                <div id="vacation-requests" class="sub-tab-content active">
                    <div id="all-requests-list" class="loading">Chargement...</div>
                </div>
                
                <div id="sickness-declarations" class="sub-tab-content">
                    <div id="admin-sickness-list" class="loading">Chargement...</div>
                </div>

                <div id="admin-documents" class="sub-tab-content">
                    <div id="admin-documents-list" class="loading">Chargement...</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Scripts modulaires -->
    <script src="/static/js/utils.js"></script>
    <script src="/static/js/auth.js"></script>
    <script src="/static/js/dashboard.js"></script>
    <script src="/static/js/calendar.js"></script>
    <script src="/static/js/admin.js"></script>
    <script src="/static/js/sickness.js"></script>
    <script src="/static/js/main.js"></script>
</body>
</html>